var i=Object.defineProperty;var c=(s,e,t)=>e in s?i(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>c(s,typeof e!="symbol"?e+"":e,t);import{D as u}from"../../chunks/defaults-BtCEwwT1.js";const m=`You are a professional chat message translator. 
Your task is to translate the given chat message into the target language.
Rules:
- Output ONLY the translated text. No explanations, no notes, no quotes.
- Preserve emoticons, emojis, and special symbols as-is.
- Keep usernames and URLs unchanged.
- If the message is already in the target language or is untranslatable (e.g., only symbols), output it as-is.`;class g{constructor(e,t){n(this,"baseUrl");n(this,"model");this.baseUrl=e.replace(/\/$/,""),this.model=t}async translate(e,t){const a={model:this.model,messages:[{role:"system",content:m},{role:"user",content:`Translate the following chat message to ${t}:
${e}`}],temperature:.3,max_tokens:256,stream:!1},r=await fetch(`${this.baseUrl}/v1/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error(`API request failed: ${r.status} ${r.statusText}`);const l=(await r.json()).choices?.[0]?.message?.content?.trim();if(!l)throw new Error("Empty response from API");return l}}async function h(){return new Promise(s=>{chrome.storage.local.get(u,e=>{s(e)})})}chrome.runtime.onMessage.addListener((s,e,t)=>s.type!=="TRANSLATE"?!1:((async()=>{try{const a=await h();if(!a.enabled){t({success:!1,error:"Translation is disabled"});return}const o=await new g(a.apiBase,a.model).translate(s.text,a.targetLang);t({success:!0,result:o})}catch(a){const r=a instanceof Error?a.message:"Unknown error";console.error("[SOOP Translator] Translation error:",r),t({success:!1,error:r})}})(),!0));
