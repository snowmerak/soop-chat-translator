const a="data-soop-translated";let i=[],c=!1;async function d(){if(c||i.length===0)return;c=!0,i.shift()()}function g(t){i.push(t),d()}function E(t){return new Promise((r,n)=>{const o={type:"TRANSLATE",text:t};chrome.runtime.sendMessage(o,e=>{if(chrome.runtime.lastError){n(new Error(chrome.runtime.lastError.message));return}e.success&&e.result?r(e.result):n(new Error(e.error??"Unknown error"))})})}function p(t,r){const n=t.parentElement?.querySelector(".soop-translation");n&&n.remove();const o=document.createElement("span");o.className="soop-translation",o.textContent=`üåê ${r}`,o.style.cssText=["display: block","font-size: 0.85em","color: #aaaadd","margin-top: 2px","word-break: break-word","user-select: text"].join(";"),t.insertAdjacentElement("afterend",o)}async function s(t){const r=t.parentElement;if(!r||r.getAttribute(a)==="true")return;r.setAttribute(a,"true");const n=t.textContent?.trim();if(!(!n||n.length<2))return new Promise(o=>{g(async()=>{try{const e=await E(n);e&&e!==n&&p(t,e)}catch(e){console.warn("[SOOP Translator] Failed to translate:",e),r.removeAttribute(a)}finally{c=!1,d(),o()}})})}const b=".message-text[id] p#message-original";function l(t){return Array.from(t.querySelectorAll(b))}function f(){new MutationObserver(n=>{for(const o of n)for(const e of o.addedNodes){if(!(e instanceof Element))continue;if(e.matches("p#message-original")){s(e);continue}const u=e.querySelector("p#message-original");if(u){s(u);continue}for(const m of l(e))s(m)}}).observe(document.body,{childList:!0,subtree:!0});const r=l(document);for(const n of r)s(n);console.log("[SOOP Translator] Chat observer started.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();
